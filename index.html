<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ALBAY STEPS</title>

<style>
body {
  background:#000;
  color:#fff;
  font-family: Arial, sans-serif;
  margin:0;
  padding:0;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card {
  background:#111;
  padding:25px;
  width:90%;
  max-width:340px;
  border-radius:14px;
  box-shadow:0 0 20px rgba(255,0,0,0.3);
}
h1 { text-align:center; margin-bottom:5px; }
.small { text-align:center; font-size:13px; margin-bottom:15px; }

.kpi div {
  margin-bottom:12px;
  font-size:18px;
}

button {
  width:100%;
  padding:12px;
  margin-bottom:14px;
  background:#b30000;
  border:none;
  border-radius:12px;
  font-weight:700;
  color:#fff;
  font-size:15px;
  cursor:pointer;
}
button:hover { background:#d10000; }
</style>
</head>

<body>
<div class="card">
<h1>ALBAY STEPS</h1>
<div id="who" class="small">YÃ¼kleniyor...</div>

<div class="kpi">
  <div>GÃ¼nlÃ¼k<br><b id="todaySteps">0</b></div>
  <div>Toplam<br><b id="totalSteps">0</b></div>
  <div>Puan<br><b id="points">0</b></div>
</div>

<!-- âœ… AdÄ±m GeÃ§miÅŸini GÃ¶r Butonu -->
<button id="stepsHistory">AdÄ±m GeÃ§miÅŸini GÃ¶r ðŸ‘£</button>

<button id="mockStep">+100 AdÄ±m (Test)</button>
<button id="signOut">Ã‡Ä±kÄ±ÅŸ Yap</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAEQy9wEnip-cIsBRUdm6raL_uTkw7xmZk",
  authDomain: "albay-steps.firebaseapp.com",
  projectId: "albay-steps",
  storageBucket: "albay-steps.appspot.com",
  messagingSenderId: "102626470999",
  appId: "1:102626470999:web:2c697025141254ce6d2c4d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const whoEl = document.getElementById("who");
const todayStepsEl = document.getElementById("todaySteps");
const totalStepsEl = document.getElementById("totalSteps");
const pointsEl = document.getElementById("points");
const mockBtn = document.getElementById("mockStep");
const stepsHistoryBtn = document.getElementById("stepsHistory");
const signOutBtn = document.getElementById("signOut");

onAuthStateChanged(auth, async (user) => {
  if (!user) return location.href = "index.html";
  whoEl.textContent = user.email;

  const ref = doc(db, "users", user.email);
  const snap = await getDoc(ref);
  const u = snap.data() || {};

  totalStepsEl.textContent = u.totalSteps || 0;
  todayStepsEl.textContent = u.todaySteps || 0;
  pointsEl.textContent = u.points || 0;
});

mockBtn.onclick = async () => {
  const add = 100;
  const email = auth.currentUser.email;
  const time = new Date().toLocaleString("tr-TR");

  await setDoc(doc(db,"users",email,"stepsLog",`${Date.now()}`), {
    amount: add,
    time: time
  });

  const ref = doc(db,"users",email);
  const snap = await getDoc(ref);
  const u = snap.data() || {};

  await updateDoc(ref,{
    totalSteps:(u.totalSteps||0)+add,
    points:(u.points||0)+Math.floor(add/100)
  });

  totalStepsEl.textContent = (u.totalSteps||0)+add;
  pointsEl.textContent = (u.points||0)+Math.floor(add/100);

  alert("+100 adÄ±m eklendi âœ…");
};

// âœ… AdÄ±m GeÃ§miÅŸi sayfasÄ±na git
stepsHistoryBtn.onclick = () => location.href = "steps.html";

// Ã‡Ä±kÄ±ÅŸ
signOutBtn.onclick = () => signOut(auth).then(()=>location.href="index.html");
</script>

</body>
</html>
