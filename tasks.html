<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Görevler • ALBAY STEPS</title>
<script>const API_URL="https://script.google.com/macros/s/AKfycbxHcjw7HYAM6AgrpC7vF27oSeVqJo3TSngJDnS-ELblvvVNDq3ywTU0xqyRL-IG5bAY/exec";</script>
<style>
body{margin:0;background:#000;color:#fff;font-family:Arial}
.wrap{max-width:540px;margin:20px auto;padding:16px}
.top{display:flex;gap:8px;justify-content:space-between;align-items:center}
.btn{padding:10px 14px;border:none;border-radius:8px;background:#e30613;color:#fff;font-weight:700}
.card{background:#111;border-radius:12px;padding:14px;margin-top:12px}
.title{display:flex;justify-content:space-between;align-items:center}
.chip{background:#1a1a1a;border-radius:6px;padding:6px 10px}
input{width:100%;padding:12px;border:none;border-radius:8px;margin-top:10px;background:#0b0b0b;color:#fff}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <button class="btn" onclick="history.back()">← Panele Dön</button>
    <div>Kullanıcı: <b id="u"></b></div>
  </div>
  <h2 style="color:#e30613">Görevler</h2>
  <div id="list"></div>
</div>
<script>
function me(){return (localStorage.getItem('userEmail')||'').trim()}
function uiTask(t){
  const el=document.createElement('div'); el.className='card';
  el.innerHTML=`
    <div class="title"><b>${t.title}</b><span class="chip">+${t.reward} ₺</span></div>
    <div style="opacity:.85;margin:6px 0 8px">${t.desc||''}</div>
    <div id="holder-${t.id}"></div>
    <button class="btn" style="width:100%;margin-top:10px" onclick='claim(${JSON.stringify(t)})'>Tamamladım</button>
  `;
  const h=el.querySelector('#holder-'+t.id);
  if(t.type==='instagram'){ h.innerHTML=`<input id="val-${t.id}" placeholder="@kullanici veya link">`; }
  else if(t.type==='steps'){ h.innerHTML=`<input id="val-${t.id}" type="number" placeholder="Bugünkü adım sayısı">`; }
  else{ h.innerHTML=`<input id="val-${t.id}" placeholder="Kanıt/Not">`; }
  return el;
}
async function load(){
  const email=me(); if(!email){alert('Önce giriş yap');location.href='login.html';return}
  document.getElementById('u').textContent=email;
  const r=await fetch(API_URL+'?tasks=1'); const tasks=await r.json();
  const list=document.getElementById('list'); list.innerHTML='';
  tasks.forEach(t=>list.appendChild(uiTask(t)));
}
async function claim(t){
  const email=me(); if(!email) return alert('Önce giriş yap');
  const v=(document.getElementById('val-'+t.id)?.value||'').trim();
  const url=`${API_URL}?complete=1&email=${encodeURIComponent(email)}&taskId=${encodeURIComponent(t.id)}&value=${encodeURIComponent(v)}`;
  const r=await fetch(url); alert(await r.text());
}
load();
</script>
</body>
</html>
