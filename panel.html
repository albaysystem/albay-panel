<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Panel • ALBAY STEPS</title>
<script>const API_URL="https://script.google.com/macros/s/AKfycbxHcjw7HYAM6AgrpC7vF27oSeVqJo3TSngJDnS-ELblvvVNDq3ywTU0xqyRL-IG5bAY/exec";</script>
<style>
body{margin:0;background:#000;color:#fff;font-family:Arial;text-align:center}
.card{max-width:460px;margin:30px auto;background:#111;padding:20px;border-radius:12px}
h1{color:#e30613;margin:0 0 8px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.btn{flex:1;min-width:140px;padding:12px;border:none;border-radius:8px;background:#e30613;color:#fff;font-weight:700}
input{width:100%;padding:12px;border:none;border-radius:8px;margin-top:8px}
.kv{display:flex;justify-content:space-between;background:#151515;border-radius:8px;padding:10px;margin:10px 0}
.small{color:#bbb;font-size:12px}
</style>
</head>
<body>
<div class="card">
  <h1>ALBAY STEPS • Panel</h1>
  <div class="small">Kullanıcı: <span id="who"></span></div>
  <div class="kv"><div>Bakiye</div><div><b id="bal">0 ₺</b></div></div>
  <div class="row">
    <button class="btn" onclick="refresh()">Bakiyeyi Yenile</button>
    <button class="btn" onclick="location.href='tasks.html'">Görevler</button>
  </div>

  <h3 style="margin-top:16px">Para Çekme Talebi</h3>
  <input id="iban" placeholder="TR IBAN">
  <input id="amt" type="number" placeholder="Tutar (₺)">
  <button class="btn" onclick="withdraw()">Talep Gönder</button>

  <div class="row" style="margin-top:16px">
    <button class="btn" onclick="location.href='steps.html'">Adım Say</button>
    <button class="btn" onclick="location.href='admin.html'">Admin</button>
  </div>
  <button class="btn" style="background:#444;margin-top:12px" onclick="logout()">Çıkış</button>
</div>
<script>
function me(){return (localStorage.getItem('userEmail')||'').trim()}
function guard(){if(!me()){alert('Önce giriş yap');location.href='login.html';return false}return true}
function who(){document.getElementById('who').textContent=me()||'-'}
async function refresh(){ if(!guard())return; const r=await fetch(`${API_URL}?balance=1&email=${encodeURIComponent(me())}`); const t=await r.text(); document.getElementById('bal').textContent=(Number(t)||0)+' ₺' }
async function withdraw(){
  if(!guard())return;
  const iban=(document.getElementById('iban').value||'').toUpperCase().trim();
  const amt=Number(document.getElementById('amt').value||0);
  if(!iban.startsWith('TR')||iban.length<20) return alert('Geçerli TR IBAN gir');
  if(!amt||amt<=0) return alert('Geçerli tutar gir');
  const r=await fetch(`${API_URL}?withdraw=1&email=${encodeURIComponent(me())}&iban=${encodeURIComponent(iban)}&amount=${encodeURIComponent(amt)}`);
  alert(await r.text()); refresh(); document.getElementById('amt').value='';
}
function logout(){localStorage.removeItem('userEmail');location.href='login.html'}
who(); refresh();
</script>
</body>
</html>
