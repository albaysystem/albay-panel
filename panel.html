<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ALBAY STEPS • Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#000;color:#fff;font-family:Arial;margin:0;text-align:center;}
.container{max-width:400px;margin:40px auto;padding:20px;}
h2{margin-bottom:10px;}
#balance{font-size:22px;font-weight:bold;margin:10px 0;}
button,input{width:100%;padding:14px;margin-top:10px;border:none;border-radius:6px;font-size:16px;}
button{background:#ff0000;color:#fff;font-weight:bold;}
button#logout{background:#444;}
</style>
</head>
<body>

<div class="container">
<h2>ALBAY STEPS • Panel</h2>

<div id="balance">Bakiye: 0 ₺</div>
<button onclick="refreshBalance()">Bakiyeyi Yenile</button>

<h3 style="margin-top:25px;">Para Çekme Talebi</h3>
<input id="ibanInput" placeholder="TR IBAN" />
<input id="amountInput" type="number" placeholder="Örn: 50" />
<button onclick="sendWithdraw()">Talep Gönder</button>

<button id="logout" onclick="logout()">Çıkış Yap</button>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyueArV7uzUNeX0Qz3I22CXbvKyeOf6lNvdWiBMJM0FRNwYAUSTFM-0ObNEdHw0S8rE/exec";

function getEmail(){
  const e=localStorage.getItem("userEmail");
  return e?e.trim():"";
}

function logout(){
  localStorage.removeItem("userEmail");
  window.location.href="login.html";
}

async function refreshBalance(){
  try{
    const email=getEmail();
    if(!email){alert("Giriş yapmadın.");return;}
    const res=await fetch(`${API_URL}?email=${encodeURIComponent(email)}`);
    const txt=await res.text();
    const bal=Number(txt)||0;
    document.getElementById("balance").textContent="Bakiye: "+bal+" ₺";
  }catch(e){alert("Bakiye alınamadı.");}
}

async function sendWithdraw(){
  const email=getEmail();
  if(!email){alert("Giriş yap.");return;}

  const iban=document.getElementById("ibanInput").value.trim().toUpperCase();
  const amount=Number(document.getElementById("amountInput").value);

  if(!iban.startsWith("TR")||iban.length<20){alert("Geçerli IBAN gir.");return;}
  if(!amount||amount<=0){alert("Tutar geçersiz.");return;}

  try{
    const res=await fetch(`${API_URL}?withdraw=1&email=${encodeURIComponent(email)}&iban=${encodeURIComponent(iban)}&amount=${amount}`);
    const msg=await res.text();
    alert(msg);
    refreshBalance();
  }catch(e){alert("Talep gönderilemedi.");}
}

document.addEventListener("DOMContentLoaded",refreshBalance);
</script>

</body>
</html>
