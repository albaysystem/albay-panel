<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ALBAY ADMIN</title>
<style>
  :root{--bg:#0b0b0c;--card:#141416;--text:#f2f2f2;--muted:#9aa0a6;--accent:#d11;--accent2:#ff2a2a;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .wrap{max-width:720px;margin:40px auto;padding:0 16px}
  .card{background:var(--card);border-radius:18px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:0 0 14px;font-size:28px;letter-spacing:.5px}
  .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  input[type="email"],input[type="number"]{
    flex:1;min-width:220px;background:#0f0f10;border:1px solid #2a2a2c;color:var(--text);
    padding:12px 14px;border-radius:12px;outline:none
  }
  button{
    background:var(--accent);border:none;color:white;padding:12px 16px;border-radius:12px;
    font-weight:600;cursor:pointer;transition:.2s transform ease, .2s opacity ease
  }
  button:hover{transform:translateY(-1px);opacity:.95}
  .btn-ghost{background:#202124;color:var(--text)}
  .muted{color:var(--muted);font-size:14px}
  .stat{font-size:18px;margin-top:10px}
  .ok{color:#4ade80}.err{color:#ff6b6b}
  .log{margin-top:14px;background:#0f0f10;border:1px solid #232325;padding:12px;border-radius:12px;min-height:46px;white-space:pre-wrap}
  /* Login overlay */
  .overlay{
    position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;z-index:99
  }
  .login{width:min(420px,92vw);background:var(--card);border-radius:16px;padding:22px}
  .login h2{margin:0 0 10px}
  .login input{width:100%}
  .divider{height:1px;background:#262628;margin:16px 0}
  .brand{font-weight:800;color:#fff;font-size:13px;letter-spacing:2px}
  .danger{background:var(--accent2)}
</style>
</head>
<body>

<div class="overlay" id="overlay">
  <div class="login">
    <div class="brand">ALBAY • ADMIN GİRİŞ</div>
    <h2>Şifreyi Gir</h2>
    <input id="pwd" type="password" placeholder="••••••••" />
    <div class="row" style="margin-top:12px">
      <button id="loginBtn">Giriş yap</button>
    </div>
    <div id="loginMsg" class="muted" style="margin-top:8px"></div>
    <div class="divider"></div>
    <div class="muted">Yetkisiz girişler kaydedilir.</div>
  </div>
</div>

<div class="wrap">
  <div class="card">
    <h1>ALBAY ADMIN PANEL</h1>
    <div class="muted">E-posta ile bakiyeleri görüntüleyin, artırın veya düşürün.</div>

    <div class="row">
      <input id="email" type="email" placeholder="kullanici@eposta.com" />
      <button id="showBtn" class="btn-ghost">Bakiyeyi Göster</button>
    </div>

    <div id="balance" class="stat muted">Bakiye: —</div>

    <div class="row">
      <input id="amount" type="number" step="1" placeholder="Tutar (ör. 10)" />
      <button id="addBtn">Tutar Ekle</button>
      <button id="subBtn" class="danger">Tutar Düş</button>
    </div>

    <div id="msg" class="log"></div>
  </div>
</div>

<script>
  // *** BURAYI DEĞİŞTİRME — senin Apps Script adresin ***
  const API_URL = "https://script.google.com/macros/s/AKfycbxPnjJLUmjyQ0CtFC04rpksLujxUmDyyXYsIbRtRmF3Y8Q93a5i1GnkqCARsnFNRqOE/exec";
  // Admin şifresi:
  const PASSWORD = "687280.m";

  // Login
  const overlay = document.getElementById('overlay');
  const loginBtn = document.getElementById('loginBtn');
  const loginMsg = document.getElementById('loginMsg');
  loginBtn.addEventListener('click', () => {
    const val = document.getElementById('pwd').value.trim();
    if (val === PASSWORD) {
      overlay.style.display = 'none';
      localStorage.setItem('albay_admin_ok', '1');
    } else {
      loginMsg.textContent = "Hatalı şifre.";
      loginMsg.style.color = "#ff6b6b";
    }
  });
  // Oturum hatırlatma
  if (localStorage.getItem('albay_admin_ok') === '1') overlay.style.display = 'none';

  // Elemanlar
  const emailEl = document.getElementById('email');
  const amountEl = document.getElementById('amount');
  const showBtn = document.getElementById('showBtn');
  const addBtn  = document.getElementById('addBtn');
  const subBtn  = document.getElementById('subBtn');
  const msgEl   = document.getElementById('msg');
  const balEl   = document.getElementById('balance');

  function setMsg(t, ok=false){
    msgEl.textContent = t;
    msgEl.style.borderColor = ok ? "#234f32" : "#3a2323";
  }
  function setBal(v){
    balEl.textContent = "Bakiye: " + v + " ₺";
    balEl.className = "stat " + (isNaN(v) ? "muted" : "ok");
  }

  async function getBalance(email){
    const u = API_URL + "?email=" + encodeURIComponent(email);
    const r = await fetch(u, {method:"GET"});
    const txt = await r.text();
    return txt.trim();
  }
  async function postAmount(email, amount){
    const form = new FormData();
    form.append("email", email);
    form.append("amount", amount);
    const r = await fetch(API_URL, {method:"POST", body:form});
    const txt = await r.text();
    return txt.trim();
  }

  showBtn.addEventListener('click', async ()=>{
    const email = emailEl.value.trim();
    if(!email) return setMsg("Email yaz.", false);
    setMsg("Sorgulanıyor…");
    try {
      const bal = await getBalance(email);
      setBal(bal);
      setMsg("Bakiye getirildi.", true);
    } catch(e){
      setMsg("Hata: " + e, false);
    }
  });

  addBtn.addEventListener('click', async ()=>{
    const email = emailEl.value.trim();
    const amt = parseFloat(amountEl.value);
    if(!email || isNaN(amt)) return setMsg("Email ve tutar gir.", false);
    setMsg("Ekleniyor…");
    try{
      const newBal = await postAmount(email, amt);
      setBal(newBal);
      setMsg(`+${amt} eklendi. Yeni bakiye: ${newBal}`, true);
    }catch(e){ setMsg("Hata: " + e, false); }
  });

  subBtn.addEventListener('click', async ()=>{
    const email = emailEl.value.trim();
    const amt = parseFloat(amountEl.value);
    if(!email || isNaN(amt)) return setMsg("Email ve tutar gir.", false);
    setMsg("Düşülüyor…");
    try{
      const newBal = await postAmount(email, -Math.abs(amt));
      setBal(newBal);
      setMsg(`-${Math.abs(amt)} düşüldü. Yeni bakiye: ${newBal}`, true);
    }catch(e){ setMsg("Hata: " + e, false); }
  });
</script>
</body>
</html>
