<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ALBAY STEPS • Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#000;color:#fff;font-family:Arial;margin:0;text-align:center;}
.container{max-width:600px;margin:auto;margin-top:40px;background:#111;padding:20px;border-radius:14px;}
input,button{width:100%;padding:12px;border:none;border-radius:8px;margin-top:10px;}
button{background:#ff0000;color:#fff;font-weight:bold;}
table{width:100%;margin-top:20px;border-collapse:collapse;}
td,th{border-bottom:1px solid #333;padding:8px;}
.ghost{background:#333;}
</style>
</head>
<body>

<div class="container">
<h2>ALBAY STEPS • Admin Panel</h2>

<h3>Kullanıcı Bakiyeleri</h3>
<table id="usersTable">
<tr><th>Kullanıcı</th><th>Bakiye (₺)</th></tr>
</table>
<button onclick="loadUsers()">Yenile</button>

<h3>Bakiye Ekle / Düş</h3>
<input type="text" id="email" placeholder="9055XXXXXXXX">
<input type="number" id="amount" placeholder="Örn: +20 veya -10">
<button onclick="updateBalance()">Uygula</button>

<h3>Çekim Talepleri</h3>
<table id="withdrawTable">
<tr><th>Kullanıcı</th><th>IBAN</th><th>Tutar</th></tr>
</table>
<button onclick="loadWithdraws()">Yenile</button>

<button class="ghost" onclick="localStorage.removeItem('admin');location.reload();">Çıkış Yap</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyKGnhEBtOwlRsuNbAWGP7OFU887akGiQs1jNyXU0IjymIAiu30kNdmhW1fjCxLIrnS/exec";

// Admin girişi kontrol
if(!localStorage.getItem("admin")){
  let p = prompt("Admin Şifre:");
  if(p !== "1905"){ alert("Hatalı şifre!"); location.href="index.html"; }
  else localStorage.setItem("admin","ok");
}

function loadUsers(){
  fetch(API_URL + "?all=1")
  .then(r=>r.json())
  .then(data=>{
    let t = document.getElementById("usersTable");
    t.innerHTML = "<tr><th>Kullanıcı</th><th>Bakiye (₺)</th></tr>";
    data.forEach(v=> t.innerHTML += `<tr><td>${v.email}</td><td>${v.balance}</td></tr>`);
  });
}

function updateBalance(){
  let email = document.getElementById("email").value;
  let amount = document.getElementById("amount").value;
  fetch(API_URL + `?admin=1&email=${email}&amount=${amount}`)
  .then(r=>r.text())
  .then(msg=>{ alert(msg); loadUsers(); });
}

function loadWithdraws(){
  fetch(API_URL + "?withdraws=1")
  .then(r=>r.json())
  .then(data=>{
    let t = document.getElementById("withdrawTable");
    t.innerHTML = "<tr><th>Kullanıcı</th><th>IBAN</th><th>Tutar</th></tr>";
    data.forEach(v=> t.innerHTML += `<tr><td>${v.email}</td><td>${v.iban}</td><td>${v.amount} ₺</td></tr>`);
  });
}

loadUsers();
loadWithdraws();
</script>

</body>
</html>
